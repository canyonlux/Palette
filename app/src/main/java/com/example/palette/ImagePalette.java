package com.example.palette;

import android.content.Intent;
import android.graphics.Bitmap;
import android.graphics.BitmapFactory;
import android.os.Bundle;
import android.transition.Explode;
import android.transition.Transition;
import android.transition.TransitionInflater;
import android.view.View;
import android.view.Window;
import android.widget.ImageView;
import android.widget.TextView;
import androidx.appcompat.widget.Toolbar;
import androidx.annotation.Nullable;
import androidx.appcompat.app.AppCompatActivity;
import androidx.palette.graphics.Palette;

public class ImagePalette extends AppCompatActivity {

    private Toolbar toolbar;
    private ImageView imageView;
    private TextView lightVibrantTextView, mutedTextView, darkMutedTextView, lightMutedTextView;

    @Override
    protected void onCreate(@Nullable Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        // Solicita la característica de transiciones de contenido antes de llamar a setContentView
        getWindow().requestFeature(Window.FEATURE_CONTENT_TRANSITIONS);

        Explode explode= new Explode();
        explode.setDuration(2000); // Duración de la animación en milisegundos
        getWindow().setEnterTransition(explode);
        setContentView(R.layout.activity_image_palette);

        // Transición de entrada personalizada
        overridePendingTransition(R.anim.fade_in, R.anim.stay);

        // Inicialización de los elementos de la UI
        toolbar = findViewById(R.id.toolbar);
        setSupportActionBar(toolbar);
        imageView = findViewById(R.id.imageView);
        lightVibrantTextView = findViewById(R.id.lightVibrantTextView);
        mutedTextView = findViewById(R.id.mutedTextView);
        darkMutedTextView = findViewById(R.id.darkMutedTextView);
        lightMutedTextView = findViewById(R.id.lightMutedTextView);

        // Obtener la imagen seleccionada y mostrarla
        int selectedImage = getIntent().getIntExtra("image_resource", 0);
        imageView.setImageResource(selectedImage);

        // Extracción de colores con Palette
        Bitmap bitmap = BitmapFactory.decodeResource(getResources(), selectedImage);
        if (bitmap != null && !bitmap.isRecycled()) {
            Palette.from(bitmap).generate(this::applyPalette);
        }

        // Botón para volver atrás con animación personalizada
        toolbar.setNavigationOnClickListener(v -> onBackPressed());
    }

    private void applyPalette(Palette palette) {
        if (palette != null) {
            Palette.Swatch vibrantSwatch = palette.getVibrantSwatch();
            if (vibrantSwatch != null) {
                toolbar.setBackgroundColor(vibrantSwatch.getRgb());
                getWindow().setStatusBarColor(vibrantSwatch.getRgb());
            }

            setTextViewBackgroundColor(palette.getLightVibrantSwatch(), lightVibrantTextView);
            setTextViewBackgroundColor(palette.getMutedSwatch(), mutedTextView);
            setTextViewBackgroundColor(palette.getDarkMutedSwatch(), darkMutedTextView);
            setTextViewBackgroundColor(palette.getLightMutedSwatch(), lightMutedTextView);
        }
    }

    private void setTextViewBackgroundColor(Palette.Swatch swatch, TextView textView) {
        if (swatch != null) {
            textView.setBackgroundColor(swatch.getRgb());
        }
    }

    @Override
    public void onBackPressed() {
        super.onBackPressed();
        // Transición de salida personalizada
        overridePendingTransition(R.anim.fade_in, R.anim.slide_out);
    }

    // Método para iniciar ImagePalette desde otra actividad
    public static void startImagePaletteActivity(AppCompatActivity activity, int imageResource) {
        Intent intent = new Intent(activity, ImagePalette.class);
        intent.putExtra("image_resource", imageResource);
        activity.startActivity(intent);
        // Transición de entrada personalizada para la nueva actividad
        activity.overridePendingTransition(R.anim.fade_in, R.anim.stay);
    }
}












































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































